(function(){"use strict";const f={ocean:1990538,sea:1990538,lake:2783920,reservoir:2783920,pond:3377339,river:2783920,stream:3377339,canal:2783920,water:1990538,bathymetry:1990538,forest:1723694,wood:1987888,grass:5934922,shrub:3832376,crop:9414744,barren:10518624,wetland:3827784,swamp:3827784,mangrove:2773056,moss:6982224,snow:15266040,urban:6974058,park:4882512,meadow:5934922,farmland:9414744,residential:7368816,commercial:7895160,industrial:6316128,land:9414784,default:9414784},T={motorway:{color:11051152,width:3},trunk:{color:10130568,width:2.5},primary:{color:9209984,width:2},secondary:{color:8288884,width:1.5},tertiary:{color:7367784,width:1.2},residential:{color:6710886,width:.8},unclassified:{color:5592405,width:.6},service:{color:4473924,width:.4},living_street:{color:5592405,width:.6},pedestrian:{color:8947848,width:.5},footway:{color:7829367,width:.3},path:{color:6710886,width:.3},cycleway:{color:5933658,width:.4},rail:{color:3355443,width:1},subway:{color:3355443,width:.8},tram:{color:3355443,width:.6},default:{color:5592405,width:.5}},m=[{depth:0,color:{r:74,g:176,b:208}},{depth:200,color:{r:58,g:154,b:192}},{depth:1e3,color:{r:42,g:128,b:176}},{depth:2e3,color:{r:30,g:95,b:138}},{depth:4e3,color:{r:21,g:69,b:112}},{depth:6e3,color:{r:13,g:48,b:85}},{depth:1e4,color:{r:8,g:32,b:64}}],D=["river","stream","canal","drain","ditch","waterway"],M=["ocean","sea","bay","strait","gulf","sound","harbour","harbor"],P={service:0,path:1,footway:2,cycleway:3,pedestrian:4,unclassified:5,living_street:6,residential:7,tertiary:8,secondary:9,primary:10,trunk:11,motorway:12};function p(s){return"#"+s.toString(16).padStart(6,"0")}function U(s){const n=Math.max(0,Math.min(s,1e4));let l=m[0],t=m[m.length-1];for(let u=0;u<m.length-1;u++)if(n>=m[u].depth&&n<=m[u+1].depth){l=m[u],t=m[u+1];break}const r=t.depth-l.depth,e=r>0?(n-l.depth)/r:0,i=Math.round(l.color.r+e*(t.color.r-l.color.r)),h=Math.round(l.color.g+e*(t.color.g-l.color.g)),d=Math.round(l.color.b+e*(t.color.b-l.color.b));return i<<16|h<<8|d}function R(s,n){const t=(n.subtype||n.class||n.type||n.category||"").toLowerCase();if(s==="bathymetry"){const r=typeof n.depth=="number"?n.depth:0;return U(r)}return s==="land_cover"?f[t]??f.grass:f[t]?f[t]:s==="water"?f.water:s==="land"?f.land:s==="land_use"?t.includes("forest")||t.includes("wood")?f.forest:t.includes("park")||t.includes("recreation")?f.park:t.includes("grass")||t.includes("green")||t.includes("meadow")?f.grass:t.includes("farm")||t.includes("orchard")||t.includes("vineyard")?f.crop:t.includes("water")||t.includes("basin")?f.water:t.includes("residential")?f.residential:t.includes("commercial")||t.includes("retail")?f.commercial:t.includes("industrial")?f.industrial:t.includes("cemetery")||t.includes("grave")?f.grass:f.land:f.default}function B(s){if(!s)return T.default;const l=(s.class||s.road_class||s.highway||"").toLowerCase();return T[l]??T.default}function O(s,n){const l=s.east-s.west,t=s.north-s.south;return(r,e)=>({x:(r-s.west)/l*n,y:(s.north-e)/t*n})}function k(s,n,l){if(!n||n.length===0)return;s.beginPath();const t=n[0];if(!t||t.length===0)return;const r=l(t[0][0],t[0][1]);s.moveTo(r.x,r.y);for(let e=1;e<t.length;e++){const i=l(t[e][0],t[e][1]);s.lineTo(i.x,i.y)}s.closePath();for(let e=1;e<n.length;e++){const i=n[e];if(!i||i.length===0)continue;const h=l(i[0][0],i[0][1]);s.moveTo(h.x,h.y);for(let d=1;d<i.length;d++){const u=l(i[d][0],i[d][1]);s.lineTo(u.x,u.y)}s.closePath()}}function w(s,n,l,t){if(l==="Polygon")k(s,n,t);else if(l==="MultiPolygon")for(const r of n)k(s,r,t)}function F(s,n,l){if(!n||n.length<2)return;s.beginPath();const t=l(n[0][0],n[0][1]);s.moveTo(t.x,t.y);for(let r=1;r<n.length;r++){const e=l(n[r][0],n[r][1]);s.lineTo(e.x,e.y)}s.stroke()}function A(s,n,l,t){if(l==="LineString")F(s,n,t);else if(l==="MultiLineString")for(const r of n)F(s,r,t)}function N(s,n,l,t){const r=s.width,e=s.getContext("2d");if(!e)return;e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";const i=O(t,r),d=(t.east-t.west)*111320*Math.cos((t.north+t.south)/2*Math.PI/180)/r,u=[],E=[],a=[],g=[],L=[],b=[];for(const o of n){const c=o.layer,y=(o.properties.subtype||o.properties.class||"").toLowerCase();if(c==="land")(o.type==="Polygon"||o.type==="MultiPolygon")&&u.push(o);else if(c==="land_use")E.push(o);else if(c==="land_cover")a.push(o);else if(c==="water"){if(o.type==="LineString"||o.type==="MultiLineString")D.includes(y)&&g.push(o);else if(o.type==="Polygon"||o.type==="MultiPolygon"){const v=o.properties._fromLowerZoom===!0;M.includes(y)||v?b.push(o):L.push(o)}}}const I=b.length>0&&u.length<10;if(I?(e.fillStyle=p(f.water),e.fillRect(0,0,r,r)):(e.fillStyle=p(f.land),e.fillRect(0,0,r,r)),I&&u.length>0){e.save(),e.fillStyle=p(f.land);for(const o of u)w(e,o.coordinates,o.type,i),e.fill("evenodd");e.restore()}e.save();for(const o of E){if(o.type!=="Polygon"&&o.type!=="MultiPolygon")continue;const c=R("land_use",o.properties);e.fillStyle=p(c),w(e,o.coordinates,o.type,i),e.fill("evenodd")}e.restore(),e.save();for(const o of a){if(o.type!=="Polygon"&&o.type!=="MultiPolygon")continue;const c=R("land_cover",o.properties);e.fillStyle=p(c),w(e,o.coordinates,o.type,i),e.fill("evenodd")}e.restore(),e.save(),e.strokeStyle=p(f.river),e.lineCap="round",e.lineJoin="round";for(const o of g){const c=(o.properties.subtype||o.properties.class||"").toLowerCase();let y=8;c==="stream"||c==="drain"||c==="ditch"?y=3:c==="canal"?y=12:c==="river"&&(y=20),e.lineWidth=Math.max(2,y/d),A(e,o.coordinates,o.type,i)}e.restore(),e.save();for(const o of b)e.fillStyle=p(f.water),w(e,o.coordinates,o.type,i),e.fill("evenodd");for(const o of L){const c=R("water",o.properties);e.fillStyle=p(c),w(e,o.coordinates,o.type,i),e.fill("evenodd")}e.restore();const z=l.filter(o=>{var y;if(o.layer==="connector"||o.layer!=="segment"||o.type!=="LineString"&&o.type!=="MultiLineString"||((y=o.properties)==null?void 0:y.subtype)!=="road")return!1;const c=o.properties;if(typeof c.road_flags=="string")try{if(JSON.parse(c.road_flags).some(S=>{var x;return(x=S.values)==null?void 0:x.includes("is_tunnel")}))return!1}catch{}if(typeof c.level_rules=="string")try{const v=JSON.parse(c.level_rules);if(v.length>0&&v.every(S=>typeof S.value=="number"&&S.value<0))return!1}catch{}return!(c.is_tunnel===!0||c.is_underground===!0||typeof c.level=="number"&&c.level<0)}).sort((o,c)=>{var C,S;const y=(((C=o.properties)==null?void 0:C.class)||"default").toLowerCase(),v=(((S=c.properties)==null?void 0:S.class)||"default").toLowerCase();return(P[y]??5)-(P[v]??5)});e.save(),e.lineCap="round",e.lineJoin="round";for(const o of z){const c=B(o.properties),y=Math.max(1,c.width*5/d);e.strokeStyle=p(c.color),e.lineWidth=y,A(e,o.coordinates,o.type,i)}e.restore()}function Y(s,n,l){const t=s.width,r=s.getContext("2d");if(!r)return;r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high";const e=O(l,t),i=[],h=[],d=[],u=[];for(const a of n){const g=a.layer,L=(a.properties.subtype||a.properties.class||"").toLowerCase();if(g==="land")(a.type==="Polygon"||a.type==="MultiPolygon")&&i.push(a);else if(g==="land_cover")h.push(a);else if(g==="water"&&(a.type==="Polygon"||a.type==="MultiPolygon")){const b=a.properties._fromLowerZoom===!0;M.includes(L)||b?u.push(a):d.push(a)}}const E=u.length>0&&i.length<10;if(E?(r.fillStyle=p(f.water),r.fillRect(0,0,t,t)):(r.fillStyle=p(f.land),r.fillRect(0,0,t,t)),E&&i.length>0){r.save(),r.fillStyle=p(f.land);for(const a of i)w(r,a.coordinates,a.type,e),r.fill("evenodd");r.restore()}r.save();for(const a of h){if(a.type!=="Polygon"&&a.type!=="MultiPolygon")continue;const g=R("land_cover",a.properties);r.fillStyle=p(g),w(r,a.coordinates,a.type,e),r.fill("evenodd")}r.restore(),r.save();for(const a of u)r.fillStyle=p(f.water),w(r,a.coordinates,a.type,e),r.fill("evenodd");for(const a of d){const g=R("water",a.properties);r.fillStyle=p(g),w(r,a.coordinates,a.type,e),r.fill("evenodd")}r.restore()}let _=!1;try{_=new OffscreenCanvas(1,1).getContext("2d")!==null}catch{_=!1}self.onmessage=s=>{const n=s.data;try{switch(n.type){case"CAPABILITY_CHECK":{const l={type:"CAPABILITY_CHECK_RESULT",id:n.id,supported:_};self.postMessage(l);break}case"RENDER_TILE_TEXTURE":{if(!_){const u={type:"ERROR",id:n.id,error:"OffscreenCanvas not supported in this worker"};self.postMessage(u);return}const{baseFeatures:l,transportFeatures:t,bounds:r,textureSize:e}=n.payload,i=new OffscreenCanvas(e,e);N(i,l,t,r);const h=i.transferToImageBitmap(),d={type:"RENDER_TILE_TEXTURE_RESULT",id:n.id,result:h};self.postMessage(d,{transfer:[h]});break}case"RENDER_LOW_DETAIL_TEXTURE":{if(!_){const d={type:"ERROR",id:n.id,error:"OffscreenCanvas not supported in this worker"};self.postMessage(d);return}const{baseFeatures:l,bounds:t,textureSize:r}=n.payload,e=new OffscreenCanvas(r,r);Y(e,l,t);const i=e.transferToImageBitmap(),h={type:"RENDER_LOW_DETAIL_TEXTURE_RESULT",id:n.id,result:i};self.postMessage(h,{transfer:[i]});break}default:{const l={type:"ERROR",id:n.id||"unknown",error:`Unknown request type: ${n.type}`};self.postMessage(l)}}}catch(l){const t={type:"ERROR",id:n.id,error:l instanceof Error?l.message:"Unknown error in worker"};self.postMessage(t)}},self.postMessage({type:"READY"})})();
//# sourceMappingURL=tile-texture.worker-Ct0XDOc4.js.map
