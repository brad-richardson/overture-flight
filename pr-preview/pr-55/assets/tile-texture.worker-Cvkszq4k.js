(function(){"use strict";const c={ocean:1990538,sea:1990538,lake:2783920,reservoir:2783920,pond:3377339,river:2783920,stream:3377339,canal:2783920,water:1990538,bathymetry:1990538,forest:1723694,wood:1987888,grass:5934922,shrub:3832376,crop:9414744,barren:10518624,wetland:3827784,swamp:3827784,mangrove:2773056,moss:6982224,snow:15266040,urban:6974058,park:4882512,meadow:5934922,farmland:9414744,residential:7368816,commercial:7895160,industrial:6316128,land:9414784,default:9414784},C={motorway:{color:11051152,width:3},trunk:{color:10130568,width:2.5},primary:{color:9209984,width:2},secondary:{color:8288884,width:1.5},tertiary:{color:7367784,width:1.2},residential:{color:6710886,width:.8},unclassified:{color:5592405,width:.6},service:{color:4473924,width:.4},living_street:{color:5592405,width:.6},pedestrian:{color:8947848,width:.5},footway:{color:7829367,width:.3},path:{color:6710886,width:.3},cycleway:{color:5933658,width:.4},rail:{color:3355443,width:1},subway:{color:3355443,width:.8},tram:{color:3355443,width:.6},default:{color:5592405,width:.5}},m=[{depth:0,color:{r:74,g:176,b:208}},{depth:200,color:{r:58,g:154,b:192}},{depth:1e3,color:{r:42,g:128,b:176}},{depth:2e3,color:{r:30,g:95,b:138}},{depth:4e3,color:{r:21,g:69,b:112}},{depth:6e3,color:{r:13,g:48,b:85}},{depth:1e4,color:{r:8,g:32,b:64}}],D=["river","stream","canal","drain","ditch","waterway"],M=["ocean","sea","bay","strait","gulf","sound","harbour","harbor"],P={service:0,path:1,footway:2,cycleway:3,pedestrian:4,unclassified:5,living_street:6,residential:7,tertiary:8,secondary:9,primary:10,trunk:11,motorway:12};function p(s){return"#"+s.toString(16).padStart(6,"0")}function U(s){const n=Math.max(0,Math.min(s,1e4));let l=m[0],t=m[m.length-1];for(let u=0;u<m.length-1;u++)if(n>=m[u].depth&&n<=m[u+1].depth){l=m[u],t=m[u+1];break}const r=t.depth-l.depth,e=r>0?(n-l.depth)/r:0,a=Math.round(l.color.r+e*(t.color.r-l.color.r)),y=Math.round(l.color.g+e*(t.color.g-l.color.g)),d=Math.round(l.color.b+e*(t.color.b-l.color.b));return a<<16|y<<8|d}function R(s,n){const t=(n.subtype||n.class||n.type||n.category||"").toLowerCase();if(s==="bathymetry"){const r=typeof n.depth=="number"?n.depth:0;return U(r)}return s==="land_cover"?c[t]??c.grass:c[t]?c[t]:s==="water"?c.water:s==="land"?c.land:s==="land_use"?t.includes("forest")||t.includes("wood")?c.forest:t.includes("park")||t.includes("recreation")?c.park:t.includes("grass")||t.includes("green")||t.includes("meadow")?c.grass:t.includes("farm")||t.includes("orchard")||t.includes("vineyard")?c.crop:t.includes("water")||t.includes("basin")?c.water:t.includes("residential")?c.residential:t.includes("commercial")||t.includes("retail")?c.commercial:t.includes("industrial")?c.industrial:t.includes("cemetery")||t.includes("grave")?c.grass:c.land:c.default}function B(s){if(!s)return C.default;const l=(s.class||s.road_class||s.highway||"").toLowerCase();return C[l]??C.default}function O(s,n){const l=s.east-s.west,t=s.north-s.south;return(r,e)=>({x:(r-s.west)/l*n,y:(s.north-e)/t*n})}function k(s,n,l){if(!n||n.length===0)return;s.beginPath();const t=n[0];if(!t||t.length===0)return;const r=l(t[0][0],t[0][1]);s.moveTo(r.x,r.y);for(let e=1;e<t.length;e++){const a=l(t[e][0],t[e][1]);s.lineTo(a.x,a.y)}s.closePath();for(let e=1;e<n.length;e++){const a=n[e];if(!a||a.length===0)continue;const y=l(a[0][0],a[0][1]);s.moveTo(y.x,y.y);for(let d=1;d<a.length;d++){const u=l(a[d][0],a[d][1]);s.lineTo(u.x,u.y)}s.closePath()}}function g(s,n,l,t){if(l==="Polygon")k(s,n,t);else if(l==="MultiPolygon")for(const r of n)k(s,r,t)}function F(s,n,l){if(!n||n.length<2)return;s.beginPath();const t=l(n[0][0],n[0][1]);s.moveTo(t.x,t.y);for(let r=1;r<n.length;r++){const e=l(n[r][0],n[r][1]);s.lineTo(e.x,e.y)}s.stroke()}function A(s,n,l,t){if(l==="LineString")F(s,n,t);else if(l==="MultiLineString")for(const r of n)F(s,r,t)}function N(s,n,l,t){const r=s.width,e=s.getContext("2d");if(!e)return;e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";const a=O(t,r),d=(t.east-t.west)*111320*Math.cos((t.north+t.south)/2*Math.PI/180)/r,u=[],E=[],i=[],h=[],L=[],b=[];for(const o of n){const f=o.layer,w=(o.properties.subtype||o.properties.class||"").toLowerCase();if(f==="land")(o.type==="Polygon"||o.type==="MultiPolygon")&&u.push(o);else if(f==="land_use")E.push(o);else if(f==="land_cover")i.push(o);else if(f==="water"){if(o.type==="LineString"||o.type==="MultiLineString")D.includes(w)&&h.push(o);else if(o.type==="Polygon"||o.type==="MultiPolygon"){const v=o.properties._fromLowerZoom===!0;M.includes(w)||v?b.push(o):L.push(o)}}}const I=b.length>0&&u.length<10;if(I?(e.fillStyle=p(c.water),e.fillRect(0,0,r,r)):(e.fillStyle=p(c.land),e.fillRect(0,0,r,r)),I&&u.length>0){e.save(),e.fillStyle=p(c.land);for(const o of u)g(e,o.coordinates,o.type,a),e.fill("evenodd");e.restore()}e.save();for(const o of E){if(o.type!=="Polygon"&&o.type!=="MultiPolygon")continue;const f=R("land_use",o.properties);e.fillStyle=p(f),g(e,o.coordinates,o.type,a),e.fill("evenodd")}e.restore(),e.save();for(const o of i){if(o.type!=="Polygon"&&o.type!=="MultiPolygon")continue;const f=R("land_cover",o.properties);e.fillStyle=p(f),g(e,o.coordinates,o.type,a),e.fill("evenodd")}e.restore(),e.save(),e.strokeStyle=p(c.river),e.lineWidth=Math.max(1,3/d),e.lineCap="round",e.lineJoin="round";for(const o of h)A(e,o.coordinates,o.type,a);e.restore(),e.save();for(const o of b)e.fillStyle=p(c.water),g(e,o.coordinates,o.type,a),e.fill("evenodd");for(const o of L){const f=R("water",o.properties);e.fillStyle=p(f),g(e,o.coordinates,o.type,a),e.fill("evenodd")}e.restore();const z=l.filter(o=>{var w;if(o.layer==="connector"||o.layer!=="segment"||o.type!=="LineString"&&o.type!=="MultiLineString"||((w=o.properties)==null?void 0:w.subtype)!=="road")return!1;const f=o.properties;if(typeof f.road_flags=="string")try{if(JSON.parse(f.road_flags).some(S=>{var x;return(x=S.values)==null?void 0:x.includes("is_tunnel")}))return!1}catch{}if(typeof f.level_rules=="string")try{const v=JSON.parse(f.level_rules);if(v.length>0&&v.every(S=>typeof S.value=="number"&&S.value<0))return!1}catch{}return!(f.is_tunnel===!0||f.is_underground===!0||typeof f.level=="number"&&f.level<0)}).sort((o,f)=>{var T,S;const w=(((T=o.properties)==null?void 0:T.class)||"default").toLowerCase(),v=(((S=f.properties)==null?void 0:S.class)||"default").toLowerCase();return(P[w]??5)-(P[v]??5)});e.save(),e.lineCap="round",e.lineJoin="round";for(const o of z){const f=B(o.properties),w=Math.max(1,f.width*5/d);e.strokeStyle=p(f.color),e.lineWidth=w,A(e,o.coordinates,o.type,a)}e.restore()}function Y(s,n,l){const t=s.width,r=s.getContext("2d");if(!r)return;r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high";const e=O(l,t),a=[],y=[],d=[],u=[];for(const i of n){const h=i.layer,L=(i.properties.subtype||i.properties.class||"").toLowerCase();if(h==="land")(i.type==="Polygon"||i.type==="MultiPolygon")&&a.push(i);else if(h==="land_cover")y.push(i);else if(h==="water"&&(i.type==="Polygon"||i.type==="MultiPolygon")){const b=i.properties._fromLowerZoom===!0;M.includes(L)||b?u.push(i):d.push(i)}}const E=u.length>0&&a.length<10;if(E?(r.fillStyle=p(c.water),r.fillRect(0,0,t,t)):(r.fillStyle=p(c.land),r.fillRect(0,0,t,t)),E&&a.length>0){r.save(),r.fillStyle=p(c.land);for(const i of a)g(r,i.coordinates,i.type,e),r.fill("evenodd");r.restore()}r.save();for(const i of y){if(i.type!=="Polygon"&&i.type!=="MultiPolygon")continue;const h=R("land_cover",i.properties);r.fillStyle=p(h),g(r,i.coordinates,i.type,e),r.fill("evenodd")}r.restore(),r.save();for(const i of u)r.fillStyle=p(c.water),g(r,i.coordinates,i.type,e),r.fill("evenodd");for(const i of d){const h=R("water",i.properties);r.fillStyle=p(h),g(r,i.coordinates,i.type,e),r.fill("evenodd")}r.restore()}let _=!1;try{_=new OffscreenCanvas(1,1).getContext("2d")!==null}catch{_=!1}self.onmessage=s=>{const n=s.data;try{switch(n.type){case"CAPABILITY_CHECK":{const l={type:"CAPABILITY_CHECK_RESULT",id:n.id,supported:_};self.postMessage(l);break}case"RENDER_TILE_TEXTURE":{if(!_){const u={type:"ERROR",id:n.id,error:"OffscreenCanvas not supported in this worker"};self.postMessage(u);return}const{baseFeatures:l,transportFeatures:t,bounds:r,textureSize:e}=n.payload,a=new OffscreenCanvas(e,e);N(a,l,t,r);const y=a.transferToImageBitmap(),d={type:"RENDER_TILE_TEXTURE_RESULT",id:n.id,result:y};self.postMessage(d,{transfer:[y]});break}case"RENDER_LOW_DETAIL_TEXTURE":{if(!_){const d={type:"ERROR",id:n.id,error:"OffscreenCanvas not supported in this worker"};self.postMessage(d);return}const{baseFeatures:l,bounds:t,textureSize:r}=n.payload,e=new OffscreenCanvas(r,r);Y(e,l,t);const a=e.transferToImageBitmap(),y={type:"RENDER_LOW_DETAIL_TEXTURE_RESULT",id:n.id,result:a};self.postMessage(y,{transfer:[a]});break}default:{const l={type:"ERROR",id:n.id||"unknown",error:`Unknown request type: ${n.type}`};self.postMessage(l)}}}catch(l){const t={type:"ERROR",id:n.id,error:l instanceof Error?l.message:"Unknown error in worker"};self.postMessage(t)}},self.postMessage({type:"READY"})})();
//# sourceMappingURL=tile-texture.worker-Cvkszq4k.js.map
