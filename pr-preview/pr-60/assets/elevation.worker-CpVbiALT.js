(function(){"use strict";const c=typeof OffscreenCanvas<"u";function p(r,e,s,t){return r*256+e+s/256-t}async function i(r){const e=await fetch(r,{mode:"cors"});if(!e.ok)throw new Error(`Failed to fetch image: ${e.status}`);const s=await e.blob();return createImageBitmap(s)}async function u(r,e,s){const t=await i(r),a=new OffscreenCanvas(e,e).getContext("2d");if(!a)throw new Error("Failed to get 2d context from OffscreenCanvas");a.drawImage(t,0,0,e,e),t.close();const o=a.getImageData(0,0,e,e),d=new Float32Array(e*e);for(let n=0;n<e*e;n++){const E=o.data[n*4],g=o.data[n*4+1],w=o.data[n*4+2];d[n]=p(E,g,w,s)}return{heights:d}}self.onmessage=async r=>{const e=r.data;try{switch(e.type){case"CAPABILITY_CHECK":{const s={type:"CAPABILITY_CHECK_RESULT",id:e.id,supported:c};self.postMessage(s);break}case"DECODE_ELEVATION":{if(!c)throw new Error("OffscreenCanvas not supported in this worker");const{url:s,tileSize:t,terrariumOffset:f}=e.payload,a=await u(s,t,f),o={type:"DECODE_ELEVATION_RESULT",id:e.id,result:a};self.postMessage(o,{transfer:[a.heights.buffer]});break}default:{const s={type:"ERROR",id:e.id||"unknown",error:`Elevation worker received unsupported request type: ${e.type}`};self.postMessage(s)}}}catch(s){const t={type:"ERROR",id:e.id,error:s instanceof Error?s.message:"Unknown error in elevation worker"};self.postMessage(t)}},self.postMessage({type:"READY"})})();
//# sourceMappingURL=elevation.worker-CpVbiALT.js.map
