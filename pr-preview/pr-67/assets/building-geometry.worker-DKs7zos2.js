(function(){"use strict";function pt(t,n,e=2){const o=n&&n.length,r=o?n[0]*e:t.length;let s=rt(t,0,r,e,!0);const i=[];if(!s||s.next===s.prev)return i;let l,c,a;if(o&&(s=wt(t,n,s,e)),t.length>80*e){l=t[0],c=t[1];let u=l,f=c;for(let y=e;y<r;y+=e){const d=t[y],x=t[y+1];d<l&&(l=d),x<c&&(c=x),d>u&&(u=d),x>f&&(f=x)}a=Math.max(u-l,f-c),a=a!==0?32767/a:0}return D(s,i,e,l,c,a,0),i}function rt(t,n,e,o,r){let s;if(r===Rt(t,n,e,o)>0)for(let i=n;i<e;i+=o)s=ct(i/o|0,t[i],t[i+1],s);else for(let i=e-o;i>=n;i-=o)s=ct(i/o|0,t[i],t[i+1],s);return s&&L(s,s.next)&&($(s),s=s.next),s}function F(t,n){if(!t)return t;n||(n=t);let e=t,o;do if(o=!1,!e.steiner&&(L(e,e.next)||M(e.prev,e,e.next)===0)){if($(e),e=n=e.prev,e===e.next)break;o=!0}else e=e.next;while(o||e!==n);return n}function D(t,n,e,o,r,s,i){if(!t)return;!i&&s&&It(t,o,r,s);let l=t;for(;t.prev!==t.next;){const c=t.prev,a=t.next;if(s?yt(t,o,r,s):dt(t)){n.push(c.i,t.i,a.i),$(t),t=a.next,l=a.next;continue}if(t=a,t===l){i?i===1?(t=mt(F(t),n),D(t,n,e,o,r,s,2)):i===2&&vt(t,n,e,o,r,s):D(F(t),n,e,o,r,s,1);break}}}function dt(t){const n=t.prev,e=t,o=t.next;if(M(n,e,o)>=0)return!1;const r=n.x,s=e.x,i=o.x,l=n.y,c=e.y,a=o.y,u=Math.min(r,s,i),f=Math.min(l,c,a),y=Math.max(r,s,i),d=Math.max(l,c,a);let x=o.next;for(;x!==n;){if(x.x>=u&&x.x<=y&&x.y>=f&&x.y<=d&&U(r,l,s,c,i,a,x.x,x.y)&&M(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function yt(t,n,e,o){const r=t.prev,s=t,i=t.next;if(M(r,s,i)>=0)return!1;const l=r.x,c=s.x,a=i.x,u=r.y,f=s.y,y=i.y,d=Math.min(l,c,a),x=Math.min(u,f,y),w=Math.max(l,c,a),m=Math.max(u,f,y),T=J(d,x,n,e,o),_=J(w,m,n,e,o);let h=t.prevZ,p=t.nextZ;for(;h&&h.z>=T&&p&&p.z<=_;){if(h.x>=d&&h.x<=w&&h.y>=x&&h.y<=m&&h!==r&&h!==i&&U(l,u,c,f,a,y,h.x,h.y)&&M(h.prev,h,h.next)>=0||(h=h.prevZ,p.x>=d&&p.x<=w&&p.y>=x&&p.y<=m&&p!==r&&p!==i&&U(l,u,c,f,a,y,p.x,p.y)&&M(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;h&&h.z>=T;){if(h.x>=d&&h.x<=w&&h.y>=x&&h.y<=m&&h!==r&&h!==i&&U(l,u,c,f,a,y,h.x,h.y)&&M(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=_;){if(p.x>=d&&p.x<=w&&p.y>=x&&p.y<=m&&p!==r&&p!==i&&U(l,u,c,f,a,y,p.x,p.y)&&M(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function mt(t,n){let e=t;do{const o=e.prev,r=e.next.next;!L(o,r)&&st(o,e,e.next,r)&&G(o,r)&&G(r,o)&&(n.push(o.i,e.i,r.i),$(e),$(e.next),e=t=r),e=e.next}while(e!==t);return F(e)}function vt(t,n,e,o,r,s){let i=t;do{let l=i.next.next;for(;l!==i.prev;){if(i.i!==l.i&&Et(i,l)){let c=lt(i,l);i=F(i,i.next),c=F(c,c.next),D(i,n,e,o,r,s,0),D(c,n,e,o,r,s,0);return}l=l.next}i=i.next}while(i!==t)}function wt(t,n,e,o){const r=[];for(let s=0,i=n.length;s<i;s++){const l=n[s]*o,c=s<i-1?n[s+1]*o:t.length,a=rt(t,l,c,o,!1);a===a.next&&(a.steiner=!0),r.push(Ct(a))}r.sort(Mt);for(let s=0;s<r.length;s++)e=bt(r[s],e);return e}function Mt(t,n){let e=t.x-n.x;if(e===0&&(e=t.y-n.y,e===0)){const o=(t.next.y-t.y)/(t.next.x-t.x),r=(n.next.y-n.y)/(n.next.x-n.x);e=o-r}return e}function bt(t,n){const e=zt(t,n);if(!e)return n;const o=lt(e,t);return F(o,o.next),F(e,e.next)}function zt(t,n){let e=n;const o=t.x,r=t.y;let s=-1/0,i;if(L(t,e))return e;do{if(L(t,e.next))return e.next;if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const f=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(f<=o&&f>s&&(s=f,i=e.x<e.next.x?e:e.next,f===o))return i}e=e.next}while(e!==n);if(!i)return null;const l=i,c=i.x,a=i.y;let u=1/0;e=i;do{if(o>=e.x&&e.x>=c&&o!==e.x&&it(r<a?o:s,r,c,a,r<a?s:o,r,e.x,e.y)){const f=Math.abs(r-e.y)/(o-e.x);G(e,t)&&(f<u||f===u&&(e.x>i.x||e.x===i.x&&_t(i,e)))&&(i=e,u=f)}e=e.next}while(e!==l);return i}function _t(t,n){return M(t.prev,t,n.prev)<0&&M(n.next,t,t.next)<0}function It(t,n,e,o){let r=t;do r.z===0&&(r.z=J(r.x,r.y,n,e,o)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,St(r)}function St(t){let n,e=1;do{let o=t,r;t=null;let s=null;for(n=0;o;){n++;let i=o,l=0;for(let a=0;a<e&&(l++,i=i.nextZ,!!i);a++);let c=e;for(;l>0||c>0&&i;)l!==0&&(c===0||!i||o.z<=i.z)?(r=o,o=o.nextZ,l--):(r=i,i=i.nextZ,c--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;o=i}s.nextZ=null,e*=2}while(n>1);return t}function J(t,n,e,o,r){return t=(t-e)*r|0,n=(n-o)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t|n<<1}function Ct(t){let n=t,e=t;do(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next;while(n!==t);return e}function it(t,n,e,o,r,s,i,l){return(r-i)*(n-l)>=(t-i)*(s-l)&&(t-i)*(o-l)>=(e-i)*(n-l)&&(e-i)*(s-l)>=(r-i)*(o-l)}function U(t,n,e,o,r,s,i,l){return!(t===i&&n===l)&&it(t,n,e,o,r,s,i,l)}function Et(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!Tt(t,n)&&(G(t,n)&&G(n,t)&&Nt(t,n)&&(M(t.prev,t,n.prev)||M(t,n.prev,n))||L(t,n)&&M(t.prev,t,t.next)>0&&M(n.prev,n,n.next)>0)}function M(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function L(t,n){return t.x===n.x&&t.y===n.y}function st(t,n,e,o){const r=j(M(t,n,e)),s=j(M(t,n,o)),i=j(M(e,o,t)),l=j(M(e,o,n));return!!(r!==s&&i!==l||r===0&&V(t,e,n)||s===0&&V(t,o,n)||i===0&&V(e,t,o)||l===0&&V(e,n,o))}function V(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function j(t){return t>0?1:t<0?-1:0}function Tt(t,n){let e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&st(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}function G(t,n){return M(t.prev,t,t.next)<0?M(t,n,t.next)>=0&&M(t,t.prev,n)>=0:M(t,n,t.prev)<0||M(t,t.next,n)<0}function Nt(t,n){let e=t,o=!1;const r=(t.x+n.x)/2,s=(t.y+n.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&r<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(o=!o),e=e.next;while(e!==t);return o}function lt(t,n){const e=Q(t.i,t.x,t.y),o=Q(n.i,n.x,n.y),r=t.next,s=n.prev;return t.next=n,n.prev=t,e.next=r,r.prev=e,o.next=e,e.prev=o,s.next=o,o.prev=s,o}function ct(t,n,e,o){const r=Q(t,n,e);return o?(r.next=o.next,r.prev=o,o.next.prev=r,o.next=r):(r.prev=r,r.next=r),r}function $(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Q(t,n,e){return{i:t,x:n,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Rt(t,n,e,o){let r=0;for(let s=n,i=e-o;s<e;s+=o)r+=(t[i]-t[s])*(t[s+1]+t[i+1]),i=s;return r}const ut={residential:{walls:[15260872,13943976,12099714,13219990,15062464,11047024,9139029,13468991,12357519,16113331]},commercial:{walls:[7372944,7833753,11119017,12632256,13882323,5929610,5930366,8034986,9084076,10531e3]},industrial:{walls:[6908265,8421504,11119017,7372944,4871528,6052956,7041664,10265519,12892568,13943976]},civic:{walls:[13882323,12632256,15261904,15064272,15262940,13684952,14737632,12433259,13808780,12357519]},religious:{walls:[15789024,15261909,13808780,14596231,12357519,15262936,14210252,13943976,9127187,13468991]},education:{walls:[13468991,10506797,13789470,9127187,13808780,14596231,12632256,11119017,12357519,16032864]},medical:{walls:[16316664,15790320,15263976,14737632,16119285,15527148,14213344,13160660,12109e3,10531e3]},agricultural:{walls:[9127187,10506797,13468991,13789470,8077056,9132587,14596231,13808780,7048739,8421376]},entertainment:{walls:[4868682,3100495,4013404,4868698,5921370,3947580,3096399,1842204,12632256,7372944]},military:{walls:[5597999,7048739,8421376,9145088,6908265,4871528,6250335,10506797,9139029,8421504]},outbuilding:{walls:[9127187,10506797,6908265,8421504,13808780,14596231,7048739,9083546,11053224,7372944]},service:{walls:[7372944,8421504,11119017,9083560,11579568,13158600,4871528,7041664,14211288,14737632]},transportation:{walls:[7372944,7833753,11579568,13158600,5929610,5930366,8034986,9084076,14211288,14735568]},default:{walls:[8421504,9474192,10526880,11579568,8947865,10000536,11053224,12632256,7833753,7372944]}},at={house:"residential",residential:"residential",detached:"residential",semi:"residential",semidetached_house:"residential",terrace:"residential",apartments:"residential",bungalow:"residential",dwelling_house:"residential",stilt_house:"residential",trullo:"residential",cabin:"residential",houseboat:"residential",static_caravan:"residential",ger:"residential",hut:"residential",beach_hut:"residential",allotment_house:"residential",dormitory:"residential",garage:"residential",garages:"residential",carport:"residential",boathouse:"residential",commercial:"commercial",office:"commercial",retail:"commercial",supermarket:"commercial",hotel:"commercial",kiosk:"commercial",parking:"commercial",industrial:"industrial",warehouse:"industrial",factory:"industrial",manufacture:"industrial",hangar:"industrial",storage_tank:"industrial",silo:"industrial",slurry_tank:"industrial",digester:"industrial",transformer_tower:"industrial",roof:"industrial",bridge_structure:"industrial",civic:"civic",public:"civic",government:"civic",fire_station:"civic",post_office:"civic",library:"civic",toilets:"civic",guardhouse:"civic",stadium:"civic",sports_centre:"civic",sports_hall:"civic",grandstand:"civic",pavilion:"civic",religious:"religious",church:"religious",chapel:"religious",cathedral:"religious",mosque:"religious",temple:"religious",synagogue:"religious",shrine:"religious",wayside_shrine:"religious",monastery:"religious",presbytery:"religious",school:"education",university:"education",college:"education",kindergarten:"education",hospital:"medical",agricultural:"agricultural",farm:"agricultural",barn:"agricultural",farm_auxiliary:"agricultural",cowshed:"agricultural",stable:"agricultural",sty:"agricultural",greenhouse:"agricultural",glasshouse:"agricultural",military:"military",bunker:"military",outbuilding:"outbuilding",shed:"outbuilding",service:"service",transportation:"transportation",train_station:"transportation"},Pt=new Set(["agricultural","civic","commercial","education","entertainment","industrial","medical","military","outbuilding","religious","residential","service","transportation"]);function Zt(t){return function(){let n=t+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}}function kt(t){const n=t.properties;if((n==null?void 0:n.building_id)!==void 0){let e=0;const o=String(n.building_id);for(let r=0;r<o.length;r++)e=(e<<5)-e+o.charCodeAt(r),e=e&e;return Math.abs(e)}if((n==null?void 0:n.id)!==void 0){let e=0;const o=String(n.id);for(let r=0;r<o.length;r++)e=(e<<5)-e+o.charCodeAt(r),e=e&e;return Math.abs(e)}if(t.coordinates){const e=t.type==="MultiPolygon"?t.coordinates[0][0][0]:t.coordinates[0][0];if(e&&e.length>=2)return Math.abs(Math.floor(e[0]*1e6+e[1]*1e3))}return 42}function At(t){const n=t.properties;if(!n)return"default";const e=n.subtype;if(e){const r=String(e).toLowerCase();if(Pt.has(r))return r}const o=n.class;if(o){const r=String(o).toLowerCase();if(at[r])return at[r]}return"default"}function Ft(t){const n=At(t),e=ut[n]||ut.default,o=kt(t),r=Zt(o),s=Math.floor(r()*e.walls.length);return e.walls[s]}const q=new Map;function ft(t,n,e){const o=Math.pow(2,e),r=Math.floor((t+180)/360*o),s=n*Math.PI/180,i=Math.floor((1-Math.log(Math.tan(s)+1/Math.cos(s))/Math.PI)/2*o);return[r,i]}function Lt(t,n,e){const o=Math.pow(2,e),r=t/o*360-180,s=(t+1)/o*360-180,i=Math.atan(Math.sinh(Math.PI*(1-2*n/o)))*(180/Math.PI),l=Math.atan(Math.sinh(Math.PI*(1-2*(n+1)/o)))*(180/Math.PI);return{west:r,east:s,north:i,south:l}}function Bt(t,n,e,o){return t*256+n+e/256-o}async function Ot(t,n,e){const o=`${e.zoom}/${t}/${n}`,r=q.get(o);if(r)return r;const s=e.urlTemplate.replace("{z}",e.zoom.toString()).replace("{x}",t.toString()).replace("{y}",n.toString());try{const i=await fetch(s);if(!i.ok)return null;const l=await i.blob(),c=await createImageBitmap(l),u=new OffscreenCanvas(e.tileSize,e.tileSize).getContext("2d");u.drawImage(c,0,0,e.tileSize,e.tileSize);const f=u.getImageData(0,0,e.tileSize,e.tileSize),y=new Float32Array(e.tileSize*e.tileSize);for(let w=0;w<e.tileSize*e.tileSize;w++){const m=f.data[w*4],T=f.data[w*4+1],_=f.data[w*4+2];y[w]=Bt(m,T,_,e.terrariumOffset)}const d=Lt(t,n,e.zoom),x={heights:y,bounds:d};return q.set(o,x),x}catch{return null}}function Ht(t,n,e,o){const r=Math.max(0,Math.min(o-1,n)),s=Math.max(0,Math.min(o-1,e)),i=Math.floor(r),l=Math.floor(s),c=Math.min(i+1,o-1),a=Math.min(l+1,o-1),u=r-i,f=s-l,y=t[l*o+i],d=t[l*o+c],x=t[a*o+i],w=t[a*o+c],T=[y,d,x,w].filter(_=>!Number.isNaN(_));if(T.length===0)return 0;if(T.length<4){const _=T.reduce((C,S)=>C+S,0)/T.length,h=Number.isNaN(y)?_:y,p=Number.isNaN(d)?_:d,N=Number.isNaN(x)?_:x,z=Number.isNaN(w)?_:w;return h*(1-u)*(1-f)+p*u*(1-f)+N*(1-u)*f+z*u*f}return y*(1-u)*(1-f)+d*u*(1-f)+x*(1-u)*f+w*u*f}function Yt(t,n,e){const[o,r]=ft(t,n,e.zoom),s=`${e.zoom}/${o}/${r}`,i=q.get(s);if(!i)return 0;const{heights:l,bounds:c}=i,a=(t-c.west)/(c.east-c.west),u=(c.north-n)/(c.north-c.south),f=a*(e.tileSize-1),y=u*(e.tileSize-1),d=Ht(l,f,y,e.tileSize);return Number.isNaN(d)?0:d}async function Dt(t,n){const e=new Set;for(const r of t){const s=r.type==="Polygon"?[r.coordinates]:r.coordinates;for(const i of s){const l=i[0];if(l)for(const c of l){const[a,u]=ft(c[0],c[1],n.zoom);e.add(`${a}/${u}`)}}}const o=[];for(const r of e){const[s,i]=r.split("/").map(Number);o.push(Ot(s,i,n))}await Promise.all(o)}function Ut(t,n,e){const o=n==="Polygon"?[t]:t;let r=1/0,s=-1/0,i=0;for(const l of o){const c=l[0];if(c)for(const a of c){const u=Yt(a[0],a[1],e);Number.isNaN(u)||(r=Math.min(r,u),s=Math.max(s,u),i++)}}return i===0?[0,0]:[r,s]}const tt=2,Gt=.5,$t=.3,Vt=50;function ht(t,n,e,o){const r=(t-o.lng)*o.metersPerDegLng,s=-(n-o.lat)*o.metersPerDegLat;return{x:r,y:e,z:s}}function et(t){let n=0;for(let e=0,o=t.length-1;e<t.length;o=e++)n+=(t[o].x+t[e].x)*(t[o].z-t[e].z);return n/2}function jt(t,n){return typeof t.height=="number"&&t.height>0?t.height:typeof t.num_floors=="number"&&t.num_floors>0?t.num_floors*3:n}function Kt(t){return Ft({type:t.type,coordinates:t.coordinates,properties:t.properties})}function Wt(t,n,e,o,r,s,i,l,c){if(!t||t.length===0)return null;const a=t[0];if(!a||a.length<3)return null;let u=[];for(const g of a){const v=ht(g[0],g[1],0,c);u.push({x:v.x,z:v.z})}if(u.length>1){const g=u[0],v=u[u.length-1];Math.abs(g.x-v.x)<.01&&Math.abs(g.z-v.z)<.01&&u.pop()}if(u.length<3)return null;const f=et(u);if(Math.abs(f)<1||r===tt&&Math.abs(f)<Vt||u.length<3)return null;const y=et(u);if(Math.abs(y)<1)return null;y>0&&u.reverse();const d=s*l+Gt-i*$t,x=d+n,w=d+e,m=[];for(const g of u)m.push(g.x,g.z);const T=[],_=[];if(r!==tt&&t.length>1)for(let g=1;g<t.length;g++){const v=t[g];if(!v||v.length<3)continue;T.push(m.length/2);let b=[];for(const E of v){const R=ht(E[0],E[1],0,c);b.push({x:R.x,z:R.z})}if(b.length>1){const E=b[0],R=b[b.length-1];Math.abs(E.x-R.x)<.01&&Math.abs(E.z-R.z)<.01&&b.pop()}et(b)<0&&b.reverse(),_.push(b.length);for(const E of b)m.push(E.x,E.z)}const h=pt(m,T,2);if(h.length===0)return null;const p=m.length/2,N=[];for(let g=0;g<p;g++)N.push({x:m[g*2],z:m[g*2+1]});const z=[],C=[],S=[],I=[],K=(o>>16&255)/255,W=(o>>8&255)/255,X=(o&255)/255,nt=z.length/3;for(const g of N)z.push(g.x,x,g.z),C.push(0,1,0),S.push(K,W,X);for(let g=0;g<h.length;g+=3)I.push(nt+h[g]),I.push(nt+h[g+2]),I.push(nt+h[g+1]);if(e>0){const g=z.length/3;for(const v of N)z.push(v.x,w,v.z),C.push(0,-1,0),S.push(K*.7,W*.7,X*.7);for(let v=h.length-1;v>=0;v--)I.push(g+h[v])}const ot=u.length,B=.85;for(let g=0;g<ot;g++){const v=u[g],b=u[(g+1)%ot],Z=b.x-v.x,E=b.z-v.z,R=Math.sqrt(Z*Z+E*E);if(R<.01)continue;const k=E/R,A=-Z/R,P=z.length/3,O=e>0?w:d;z.push(v.x,O,v.z),z.push(b.x,O,b.z),z.push(b.x,x,b.z),z.push(v.x,x,v.z);for(let H=0;H<4;H++)C.push(k,0,A),S.push(K*B,W*B,X*B);I.push(P+0,P+3,P+2),I.push(P+0,P+2,P+1)}if(r!==tt&&_.length>0){let g=ot;for(let v=0;v<_.length;v++){const b=_[v];for(let Z=0;Z<b;Z++){const E=g+Z,R=g+(Z+1)%b;if(E>=N.length||R>=N.length)break;const k=N[E],A=N[R],P=A.x-k.x,O=A.z-k.z,H=Math.sqrt(P*P+O*O);if(H<.01)continue;const Qt=-O/H,qt=P/H,Y=z.length/3,xt=e>0?w:d;z.push(k.x,xt,k.z),z.push(A.x,xt,A.z),z.push(A.x,x,A.z),z.push(k.x,x,k.z);for(let gt=0;gt<4;gt++)C.push(Qt,0,qt),S.push(K*B,W*B,X*B);I.push(Y+0,Y+3,Y+2),I.push(Y+0,Y+2,Y+1)}g+=b}}return{positions:z,normals:C,colors:S,indices:I}}async function Xt(t){const{features:n,origin:e,lodLevel:o,defaultHeight:r,elevationConfig:s,verticalExaggeration:i}=t;s&&await Dt(n,s);const l=[],c=[],a=[],u=[];let f=0,y=0,d=0;for(let w=0;w<n.length;w++){const m=n[w];if(m.properties.is_underground){d++;continue}if(m.properties.has_parts===!0){d++;continue}const T=m.type==="Polygon"?[m.coordinates]:m.coordinates,_=jt(m.properties,r),h=typeof m.properties.min_height=="number"?m.properties.min_height:0,p=Kt(m);let N=0,z=0;if(s){const[C,S]=Ut(m.coordinates,m.type,s);N=C,z=S-C}for(const C of T)if(!(!C||!C[0]||C[0].length<3))try{const S=Wt(C,_,h,p,o,N,z,i,e);if(S){for(const I of S.positions)l.push(I);for(const I of S.normals)c.push(I);for(const I of S.colors)a.push(I);for(const I of S.indices)u.push(I+f);f+=S.positions.length/3,y++}else d++}catch{d++}}return l.length===0?{geometry:null,stats:{buildingsProcessed:0,buildingsSkipped:d,totalVertices:0,totalTriangles:0}}:{geometry:{positions:new Float32Array(l),normals:new Float32Array(c),colors:new Float32Array(a),indices:new Uint32Array(u)},stats:{buildingsProcessed:y,buildingsSkipped:d,totalVertices:l.length/3,totalTriangles:u.length/3}}}function Jt(t){return t.geometry?[t.geometry.positions.buffer,t.geometry.normals.buffer,t.geometry.colors.buffer,t.geometry.indices.buffer]:[]}self.onmessage=t=>{const n=t.data;try{switch(n.type){case"CAPABILITY_CHECK":{const e={type:"CAPABILITY_CHECK_RESULT",id:n.id,supported:!0};self.postMessage(e);break}case"CREATE_BUILDING_GEOMETRY":{const e=n.payload;Xt(e).then(o=>{const r=Jt(o),s={type:"CREATE_BUILDING_GEOMETRY_RESULT",id:n.id,result:o};self.postMessage(s,{transfer:r})}).catch(o=>{const r={type:"ERROR",id:n.id,error:o instanceof Error?o.message:"Unknown error in building geometry worker"};self.postMessage(r)});break}default:{const e={type:"ERROR",id:n.id||"unknown",error:`Building geometry worker received unsupported request type: ${n.type}`};self.postMessage(e)}}}catch(e){const o={type:"ERROR",id:n.id,error:e instanceof Error?e.message:"Unknown error in building geometry worker"};self.postMessage(o)}},self.postMessage({type:"READY"})})();
//# sourceMappingURL=building-geometry.worker-DKs7zos2.js.map
