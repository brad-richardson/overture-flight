(function(){"use strict";const c={ocean:1990538,sea:1990538,lake:2783920,reservoir:2783920,pond:3377339,river:2783920,stream:3377339,canal:2783920,water:1990538,bathymetry:1990538,forest:1723694,wood:1987888,grass:5934922,shrub:3832376,crop:9414744,barren:10518624,wetland:3827784,swamp:3827784,mangrove:2773056,moss:6982224,snow:15266040,urban:6974058,park:4882512,meadow:5934922,farmland:9414744,residential:7368816,commercial:7895160,industrial:6316128,land:9414784,default:9414784},b={motorway:{color:11051152,width:3},trunk:{color:10130568,width:2.5},primary:{color:9209984,width:2},secondary:{color:8288884,width:1.5},tertiary:{color:7367784,width:1.2},residential:{color:6710886,width:.8},unclassified:{color:5592405,width:.6},service:{color:4473924,width:.4},living_street:{color:5592405,width:.6},pedestrian:{color:8947848,width:.5},footway:{color:7829367,width:.3},path:{color:6710886,width:.3},cycleway:{color:5933658,width:.4},rail:{color:3355443,width:1},subway:{color:3355443,width:.8},tram:{color:3355443,width:.6},default:{color:5592405,width:.5}},h=[{depth:0,color:{r:74,g:176,b:208}},{depth:200,color:{r:58,g:154,b:192}},{depth:1e3,color:{r:42,g:128,b:176}},{depth:2e3,color:{r:30,g:95,b:138}},{depth:4e3,color:{r:21,g:69,b:112}},{depth:6e3,color:{r:13,g:48,b:85}},{depth:1e4,color:{r:8,g:32,b:64}}],I=["river","stream","canal","drain","ditch","waterway"],x=["ocean","sea","bay","strait","gulf","sound","harbour","harbor"],C={service:0,path:1,footway:2,cycleway:3,pedestrian:4,unclassified:5,living_street:6,residential:7,tertiary:8,secondary:9,primary:10,trunk:11,motorway:12};function p(o){return"#"+o.toString(16).padStart(6,"0")}function Y(o){const n=Math.max(0,Math.min(o,1e4));let s=h[0],t=h[h.length-1];for(let u=0;u<h.length-1;u++)if(n>=h[u].depth&&n<=h[u+1].depth){s=h[u],t=h[u+1];break}const i=t.depth-s.depth,e=i>0?(n-s.depth)/i:0,a=Math.round(s.color.r+e*(t.color.r-s.color.r)),y=Math.round(s.color.g+e*(t.color.g-s.color.g)),d=Math.round(s.color.b+e*(t.color.b-s.color.b));return a<<16|y<<8|d}function R(o,n){const t=(n.subtype||n.class||n.type||n.category||"").toLowerCase();if(o==="bathymetry"){const i=typeof n.depth=="number"?n.depth:0;return Y(i)}return o==="land_cover"?c[t]??c.grass:c[t]?c[t]:o==="water"?c.water:o==="land"?c.land:o==="land_use"?t.includes("forest")||t.includes("wood")?c.forest:t.includes("park")||t.includes("recreation")?c.park:t.includes("grass")||t.includes("green")||t.includes("meadow")?c.grass:t.includes("farm")||t.includes("orchard")||t.includes("vineyard")?c.crop:t.includes("water")||t.includes("basin")?c.water:t.includes("residential")?c.residential:t.includes("commercial")||t.includes("retail")?c.commercial:t.includes("industrial")?c.industrial:t.includes("cemetery")||t.includes("grave")?c.grass:c.land:c.default}function B(o){if(!o)return b.default;const s=(o.class||o.road_class||o.highway||"").toLowerCase();return b[s]??b.default}function N(o,n){const s=o.east-o.west,t=o.north-o.south;return(i,e)=>({x:(i-o.west)/s*n,y:(o.north-e)/t*n})}function L(o,n,s){if(!n||n.length===0)return;o.beginPath();const t=n[0];if(!t||t.length===0)return;const i=s(t[0][0],t[0][1]);o.moveTo(i.x,i.y);for(let e=1;e<t.length;e++){const a=s(t[e][0],t[e][1]);o.lineTo(a.x,a.y)}o.closePath();for(let e=1;e<n.length;e++){const a=n[e];if(!a||a.length===0)continue;const y=s(a[0][0],a[0][1]);o.moveTo(y.x,y.y);for(let d=1;d<a.length;d++){const u=s(a[d][0],a[d][1]);o.lineTo(u.x,u.y)}o.closePath()}}function m(o,n,s,t){if(s==="Polygon")L(o,n,t);else if(s==="MultiPolygon")for(const i of n)L(o,i,t)}function E(o,n,s){if(!n||n.length<2)return;o.beginPath();const t=s(n[0][0],n[0][1]);o.moveTo(t.x,t.y);for(let i=1;i<n.length;i++){const e=s(n[i][0],n[i][1]);o.lineTo(e.x,e.y)}o.stroke()}function M(o,n,s,t){if(s==="LineString")E(o,n,t);else if(s==="MultiLineString")for(const i of n)E(o,i,t)}function U(o,n,s,t){const i=o.width,e=o.getContext("2d");if(!e)return;e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";const a=N(t,i),d=(t.east-t.west)*111320*Math.cos((t.north+t.south)/2*Math.PI/180)/i,u=[],P=[],T=[],O=[],k=[],_=[];for(const r of n){const l=r.layer,f=(r.properties.subtype||r.properties.class||"").toLowerCase();if(l==="land")(r.type==="Polygon"||r.type==="MultiPolygon")&&u.push(r);else if(l==="land_use")P.push(r);else if(l==="land_cover")T.push(r);else if(l==="water"){if(r.type==="LineString"||r.type==="MultiLineString")I.includes(f)&&O.push(r);else if(r.type==="Polygon"||r.type==="MultiPolygon"){const g=r.properties._fromLowerZoom===!0;x.includes(f)||g?_.push(r):k.push(r)}}}const A=_.length>0&&u.length<10;if(A?(e.fillStyle=p(c.water),e.fillRect(0,0,i,i)):(e.fillStyle=p(c.land),e.fillRect(0,0,i,i)),A&&u.length>0){e.save(),e.fillStyle=p(c.land);for(const r of u)m(e,r.coordinates,r.type,a),e.fill("evenodd");e.restore()}e.save();for(const r of P){if(r.type!=="Polygon"&&r.type!=="MultiPolygon")continue;const l=R("land_use",r.properties);e.fillStyle=p(l),m(e,r.coordinates,r.type,a),e.fill("evenodd")}e.restore(),e.save();for(const r of T){if(r.type!=="Polygon"&&r.type!=="MultiPolygon")continue;const l=R("land_cover",r.properties);e.fillStyle=p(l),m(e,r.coordinates,r.type,a),e.fill("evenodd")}e.restore(),e.save(),e.strokeStyle=p(c.river),e.lineCap="round",e.lineJoin="round";for(const r of O){const l=(r.properties.subtype||r.properties.class||"").toLowerCase();let f;l==="river"?f=20:l==="stream"||l==="drain"||l==="ditch"?f=3:l==="canal"?f=12:f=8,e.lineWidth=Math.max(2,f/d),M(e,r.coordinates,r.type,a)}e.restore(),e.save();for(const r of _)e.fillStyle=p(c.water),m(e,r.coordinates,r.type,a),e.fill("evenodd");for(const r of k){const l=R("water",r.properties);e.fillStyle=p(l),m(e,r.coordinates,r.type,a),e.fill("evenodd")}e.restore();const D=s.filter(r=>{var f;if(r.layer==="connector"||r.layer!=="segment"||r.type!=="LineString"&&r.type!=="MultiLineString"||((f=r.properties)==null?void 0:f.subtype)!=="road")return!1;const l=r.properties;if(typeof l.road_flags=="string")try{if(JSON.parse(l.road_flags).some(w=>{var F;return(F=w.values)==null?void 0:F.includes("is_tunnel")}))return!1}catch{}if(typeof l.level_rules=="string")try{const g=JSON.parse(l.level_rules);if(g.length>0&&g.every(w=>typeof w.value=="number"&&w.value<0))return!1}catch{}return!(l.is_tunnel===!0||l.is_underground===!0||typeof l.level=="number"&&l.level<0)}).sort((r,l)=>{var S,w;const f=(((S=r.properties)==null?void 0:S.class)||"default").toLowerCase(),g=(((w=l.properties)==null?void 0:w.class)||"default").toLowerCase();return(C[f]??5)-(C[g]??5)});e.save(),e.lineCap="round",e.lineJoin="round";for(const r of D){const l=B(r.properties),f=Math.max(1,l.width*5/d);e.strokeStyle=p(l.color),e.lineWidth=f,M(e,r.coordinates,r.type,a)}e.restore()}let v=!1;try{v=new OffscreenCanvas(1,1).getContext("2d")!==null}catch{v=!1}self.onmessage=o=>{const n=o.data;try{switch(n.type){case"CAPABILITY_CHECK":{const s={type:"CAPABILITY_CHECK_RESULT",id:n.id,supported:v};self.postMessage(s);break}case"RENDER_TILE_TEXTURE":{if(!v){const u={type:"ERROR",id:n.id,error:"OffscreenCanvas not supported in this worker"};self.postMessage(u);return}const{baseFeatures:s,transportFeatures:t,bounds:i,textureSize:e}=n.payload,a=new OffscreenCanvas(e,e);U(a,s,t,i);const y=a.transferToImageBitmap(),d={type:"RENDER_TILE_TEXTURE_RESULT",id:n.id,result:y};self.postMessage(d,{transfer:[y]});break}default:{const s={type:"ERROR",id:n.id||"unknown",error:`Unknown request type: ${n.type}`};self.postMessage(s)}}}catch(s){const t={type:"ERROR",id:n.id,error:s instanceof Error?s.message:"Unknown error in worker"};self.postMessage(t)}},self.postMessage({type:"READY"})})();
//# sourceMappingURL=tile-texture.worker-DGoTHLl1.js.map
